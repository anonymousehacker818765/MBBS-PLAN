<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MBBS Tracker</title>

<style>
:root{
  --bg:#0f172a; --card:#1e293b; --text:#f8fafc; --muted:#94a3b8;
  --border:#334155; --nav:80px;
  --anat:#f43f5e; --phy:#22c55e; --bio:#eab308; --primary:#3b82f6;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,system-ui;
  background:var(--bg);
  color:var(--text);
  padding-bottom:calc(var(--nav) + 20px);
}

.header-wrapper{
  position:sticky;top:0;z-index:100;
  background:rgba(15,23,42,.96);
  border-bottom:1px solid var(--border);
}

.app-title{
  padding:16px 20px 6px;
  margin:0;
  font-size:1.4rem;
  font-weight:800;
}

.tabs{
  display:flex;
  gap:10px;
  padding:10px 20px 12px;
  overflow-x:auto;
}

.tab-btn{
  padding:8px 16px;
  border-radius:20px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--muted);
  font-weight:600;
  cursor:pointer;
}

.tab-btn.active{background:#fff;color:#000}
.tab-btn[data-sub="Anatomy"].active{background:var(--anat)}
.tab-btn[data-sub="Physiology"].active{background:var(--phy)}
.tab-btn[data-sub="Biochemistry"].active{background:var(--bio)}

.container{padding:22px}

.date-divider{
  margin:34px 0 14px;
  display:flex;
  align-items:center;
  gap:12px;
  font-size:.8rem;
  font-weight:800;
  color:var(--muted);
  letter-spacing:.04em;
}
.date-divider::after{
  content:"";
  flex:1;
  height:1px;
  background:var(--border);
}
.date-divider.highlight{
  background:rgba(59,130,246,.15);
  padding:6px 10px;
  border-radius:6px;
}

.task-card{
  display:flex;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  margin-bottom:14px;
  overflow:hidden;
}

.card-strip{width:5px}
.task-card[data-sub="Anatomy"] .card-strip{background:var(--anat)}
.task-card[data-sub="Physiology"] .card-strip{background:var(--phy)}
.task-card[data-sub="Biochemistry"] .card-strip{background:var(--bio)}

.card-body{
  flex:1;
  padding:14px 16px;
}

.badge{
  font-size:.65rem;
  font-weight:800;
  text-transform:uppercase;
  padding:3px 6px;
  border-radius:4px;
  display:inline-block;
  margin-bottom:6px;
}

.task-card[data-sub="Anatomy"] .badge{color:var(--anat);background:rgba(244,63,94,.2)}
.task-card[data-sub="Physiology"] .badge{color:var(--phy);background:rgba(34,197,94,.2)}
.task-card[data-sub="Biochemistry"] .badge{color:var(--bio);background:rgba(234,179,8,.2)}

.task-title{
  font-size:1rem;
  font-weight:600;
  line-height:1.5;
}

.card-action{
  padding:0 16px;
  display:flex;
  align-items:center;
}

.check-btn{
  width:28px;height:28px;
  border-radius:50%;
  border:2px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.task-card.done{opacity:.5}
.task-card.done .check-btn{
  background:var(--phy);
  border-color:var(--phy);
  color:#000;
}

.nav-bar{
  position:fixed;
  bottom:0;left:0;right:0;
  height:var(--nav);
  background:rgba(15,23,42,.96);
  border-top:1px solid var(--border);
  display:flex;
}

.nav-item{
  flex:1;
  border:none;
  background:none;
  color:var(--muted);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-weight:600;
  cursor:pointer;
}

.nav-item.active{color:var(--text)}
.nav-icon{font-size:1.4rem;margin-bottom:4px}

.view{display:none}
.view.active{display:block}

.cal-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}

.cal-day{
  aspect-ratio:1;
  background:var(--card);
  border-radius:10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.cal-day.today{
  border:2px solid var(--primary);
  color:var(--primary);
  font-weight:800;
}

.cal-dots{display:flex;gap:4px;margin-top:4px}
.dot{width:6px;height:6px;border-radius:50%}
.red{background:var(--anat)}
.green{background:var(--phy)}

.progress-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
  margin-bottom:14px;
}

.progress-row{
  display:flex;
  justify-content:space-between;
  margin:6px 0;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="header-wrapper">
  <h1 class="app-title" id="title">My Feed</h1>

  <div class="tabs">
    <button class="tab-btn active" onclick="setSubject('All',this)">All</button>
    <button class="tab-btn" data-sub="Anatomy" onclick="setSubject('Anatomy',this)">Anatomy</button>
    <button class="tab-btn" data-sub="Physiology" onclick="setSubject('Physiology',this)">Physiology</button>
    <button class="tab-btn" data-sub="Biochemistry" onclick="setSubject('Biochemistry',this)">Biochemistry</button>
  </div>

  <div class="tabs">
    <button class="tab-btn active" onclick="setStatus('All',this)">All</button>
    <button class="tab-btn" onclick="setStatus('Done',this)">Completed</button>
    <button class="tab-btn" onclick="setStatus('Pending',this)">Pending</button>
  </div>
</div>

<div id="feedView" class="view active">
  <div class="container" id="feed"></div>
</div>

<div id="calendarView" class="view">
  <div class="container">
    <div class="cal-grid" id="calendar"></div>
  </div>
</div>

<div id="progressView" class="view">
  <div class="container" id="progress"></div>
</div>

<div class="nav-bar">
  <button class="nav-item active" onclick="show('feedView',this)">
    <div class="nav-icon">âš¡</div>Timeline
  </button>
  <button class="nav-item" onclick="show('calendarView',this)">
    <div class="nav-icon">ðŸ“…</div>Calendar
  </button>
  <button class="nav-item" onclick="show('progressView',this)">
    <div class="nav-icon">ðŸ“Š</div>Progress
  </button>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vREP7TsehrrFKgBrYNgyJyEc_56SWhnuXWydOyDIvjKGVwC6USsHzNdC13AlojDBuSmvi1D2H9HEudp/pub?output=csv";

let data=[],subject='All',status='All',jump=null;

const feed=document.getElementById('feed');

const clean=s=>s?.replace(/^"|"$/g,'').trim()||'';

fetch(SHEET_URL).then(r=>r.text()).then(t=>{
  data=t.split('\n').slice(1).map((r,i)=>{
    if(!r.trim())return null;
    const c=r.split(',');
    return{
      id:clean(c[0]),
      date:clean(c[1]),
      subject:clean(c[2]),
      topic:clean(c.slice(3).join(',')),
      order:i
    };
  }).filter(Boolean);
  render();
});

function render(){
  feed.innerHTML='';
  let d=[...data];
  if(subject!=='All')d=d.filter(x=>x.subject===subject);
  if(status==='Done')d=d.filter(x=>localStorage.getItem(x.id));
  if(status==='Pending')d=d.filter(x=>!localStorage.getItem(x.id));
  d.sort((a,b)=>a.date.localeCompare(b.date)||a.order-b.order);

  let last='';
  d.forEach(t=>{
    if(t.date!==last){
      const h=document.createElement('div');
      h.className='date-divider';
      h.id='d-'+t.date;
      h.textContent=t.date;
      feed.appendChild(h);
      last=t.date;
    }
    const card=document.createElement('div');
    card.className='task-card'+(localStorage.getItem(t.id)?' done':'');
    card.dataset.sub=t.subject;

    const strip=document.createElement('div');
    strip.className='card-strip';

    const body=document.createElement('div');
    body.className='card-body';

    const badge=document.createElement('span');
    badge.className='badge';
    badge.textContent=t.subject;

    const title=document.createElement('div');
    title.className='task-title';
    title.textContent=t.topic;

    body.append(badge,title);

    const act=document.createElement('div');
    act.className='card-action';

    const chk=document.createElement('div');
    chk.className='check-btn';
    chk.textContent=localStorage.getItem(t.id)?'âœ“':'';
    chk.onclick=()=>{
      localStorage.getItem(t.id)?localStorage.removeItem(t.id):localStorage.setItem(t.id,'1');
      render();renderProgress();
    };

    act.appendChild(chk);
    card.append(strip,body,act);
    feed.appendChild(card);
  });

  if(jump){
    const el=document.getElementById('d-'+jump);
    if(el){
      el.scrollIntoView({behavior:'smooth'});
      el.classList.add('highlight');
      setTimeout(()=>el.classList.remove('highlight'),700);
    }
    jump=null;
  }
}

function renderProgress(){
  const p=document.getElementById('progress');
  p.innerHTML='';
  const total=data.length;
  const done=data.filter(x=>localStorage.getItem(x.id)).length;

  const card=document.createElement('div');
  card.className='progress-card';
  card.innerHTML=`<strong>All-time</strong>
    <div class="progress-row"><span>Total</span><span>${total}</span></div>
    <div class="progress-row"><span>Completed</span><span>${done}</span></div>
    <div class="progress-row"><span>Pending</span><span>${total-done}</span></div>`;
  p.appendChild(card);
}

function setSubject(s,b){
  subject=s;
  document.querySelectorAll('.tabs .tab-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  render();
}
function setStatus(s,b){
  status=s;
  document.querySelectorAll('.tabs .tab-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  render();
}
function show(v,b){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.getElementById(v).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  document.getElementById('title').textContent=
    v==='feedView'?'My Feed':v==='calendarView'?'Calendar':'Progress';
  if(v==='progressView')renderProgress();
}
</script>

</body>
</html>
